<%@ index(State, Username, {PicGuid, Owner, Path, Type, Msg, Count, Dig, TagList, Spam, CreateDate}, {CommentCount, CommentList}) %>
<html>

<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
  <title>woomsg - showpic</title>
  <link type="text/css" href="/static/css/ui.achtung-min.css" rel="stylesheet"/>
  <link type="text/css" href="/static/css/core.css" rel="stylesheet"/>
  <style type="text/css">
  </style>
  <script language="javascript" type="text/javascript">
    function fixpng(o) {
      var arVersion = navigator.appVersion.split("MSIE");
      var version = parseFloat(arVersion[1]);
      if((version >= 5.5) && (document.body.filters)) {
        try {
          var img = o;
          var imgName = o.src.toUpperCase();
          if (imgName.substring(imgName.length-3, imgName.length) == "PNG") {
            var imgID = (img.id) ? "id='" + img.id + "' " : "";
            var imgClass = (img.className) ? "class='" + img.className + "' " : "";
            var imgTitle = (img.title) ? "title='" + img.title + "' " : "title='" + img.alt + "' ";
            var imgStyle = "display:inline-block;" + img.style.cssText;
            if (img.align == "left") 
              imgStyle = "float:left;" + imgStyle;
            if (img.align == "right") 
              imgStyle = "float:right;" + imgStyle;
            if (img.parentElement.href) 
              imgStyle = "cursor:hand;" + imgStyle;   
            
            var strNewHTML = "<span " + imgID + imgClass + imgTitle
                + " style=\"" + "width:" + img.width + "px; height:" + img.height + "px;" + imgStyle + ";" 
                + "filter:progid:DXImageTransform.Microsoft.AlphaImageLoader" 
                + "(src=\'" + img.src + "\', sizingMethod='image');\"></span>"; img.outerHTML = strNewHTML;			
            }
          } catch (e){}
        }
    }
  </script>
  <script type="text/javascript" src="/static/js/jquery-1.3.2.min.js"></script>
  <script type="text/javascript" src="/static/js/ui.achtung-min.js"></script>
  <script type="text/javascript" src="/static/js/core.js"></script>
  <script type="text/javascript" src="/static/js/showpic.js"></script>
</head>
 
<body>
  <div id="container">

    <% header_view_in:index(State, Username) %>

    <div id="main">

      <div id="photo-main">

        <div id="photo-view">

          <div id="photo">
            <div id="photo-control">
            </div>
	    <img class="photo-ori" src="<% woomsg_image:get_image_path(Path, PicGuid, Type, "mediu") %>"/>
            <div id="photo-message">
             <% Msg %>
            </div>
          </div>

          <div id="photo-comments">
            <div id="photo-comments-form">
              <form onsubmit="add_comment('<% PicGuid %>'); return false;" action="">
                <textarea class="leave-message" name="message"></textarea>
                <div style="padding-top: 7px; width: 580px; text-align: right;">
                  <input type="submit" value="添加一条评论"/>
                </div>
              </form>
            </div>

            <% display_photo_comments({CommentCount, CommentList}) %>

          </div>

        </div>
   
        <div id="photo-sidebar">
        </div>

        <div style="clear:both;"></div>

      </div>
    </div>

    <% footer_view_in:index() %>

  </div>
</body>

</html>

<%@ display_photo_comments({0, []}) %>
<% "" %>
<%@ display_photo_comments({_CommentCount, CommentList}) %>
<% [ display_photo_comment_item(Item) || Item <- CommentList ]  %>

<%@ display_photo_comment_item({pic_comment, false, Guid, PicGuid, Owner, PhotoGuid, PhotoPath, PhotoType, Comment, FormatCreateDate}) %>
<div id="<% Guid %>" class="photo-comment">
  <div class="photo-comment-avatar">
    <img class="avatar" height="48" width="48" src="<% woomsg_image:get_image_path(PhotoPath, PhotoGuid, PhotoType, "mini") %>"/>
  </div>

  <div class="photo-comment-body">
    <div class="photo-comment-info">
      <a class="nav" href="user/<% Owner %>"><% Owner %></a>   
      <span class="photo-comment-date"><% FormatCreateDate %></span>
    </div>
    <div style="float: right; width:20px;">
    </div>
    <div class="photo-comment-message">
      <% Comment %>
    </div>
  </div>

  <div style="clear:both;"></div>
</div>
<%@ display_photo_comment_item({pic_comment, true, Guid, PicGuid, Owner, PhotoGuid, PhotoPath, PhotoType, Comment, FormatCreateDate}) %>
<div id="<% Guid %>" class="photo-comment">
  <div class="photo-comment-avatar">
    <img class="avatar" height="48" width="48" src="<% woomsg_image:get_image_path(PhotoPath, PhotoGuid, PhotoType, "mini") %>"/>
  </div>

 
  <div class="photo-comment-body">
    <div class="photo-comment-info">
      <a class="nav" href="user/<% Owner %>"><% Owner %></a>
      <span class="photo-comment-date"><% FormatCreateDate %></span>
    </div>
    <div style="float: right; width=20px;">
      <form action="" onsubmit="remove_comment('<% Guid %>'); return false;">
        <input type="image" src="/static/image/icon_trash.gif"/>
      </form>
    </div>
    <div class="photo-comment-message">
      <% Comment %>
    </div>
  </div>

  <div style="clear:both;"></div>
</div>

